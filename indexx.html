<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProfiBHARAT | Secure Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@600;900&family=Outfit:wght@300;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { background: #030005; height: 100vh; display: flex; align-items: center; justify-content: center; font-family: 'Outfit', sans-serif; color: #fff; overflow: hidden; }
        .hologram-grid { position: absolute; width: 200%; height: 200%; background-image: linear-gradient(rgba(168, 85, 247, 0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(168, 85, 247, 0.08) 1px, transparent 1px); background-size: 50px 50px; transform: perspective(500px) rotateX(60deg); z-index: 1; animation: gridMove 10s linear infinite; }
        @keyframes gridMove { from { transform: translateY(0); } to { transform: translateY(50px); } }
        .auth-card { position: relative; z-index: 10; background: rgba(8, 4, 10, 0.95); padding: 40px; border-radius: 25px; border: 1px solid rgba(168, 85, 247, 0.3); width: 380px; backdrop-filter: blur(15px); text-align: center; }
        .cyber-title { font-family: 'Unbounded'; font-size: 1.5rem; margin-bottom: 25px; color: #a855f7; text-shadow: 0 0 10px #a855f7; }
        .form-wrapper { display: none; }
        .form-wrapper.active { display: block; animation: fadeInUp 0.4s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .input-box { margin-bottom: 18px; }
        .input-box input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; font-size: 0.95rem; }
        .input-box input:focus { border-color: #a855f7; background: rgba(168, 85, 247, 0.08); }
        .cyber-btn { width: 100%; padding: 15px; border-radius: 12px; border: none; background: linear-gradient(90deg, #a855f7, #6b21a8); color: #fff; font-family: 'Unbounded'; font-size: 0.85rem; cursor: pointer; font-weight: 900; }
        .switch-text { margin-top: 20px; font-size: 0.8rem; color: #aaa; }
        .switch-text span { color: #a855f7; cursor: pointer; font-weight: 600; }
    </style>
</head>
<body>

<div class="hologram-grid"></div>

<div class="auth-card">
    <h2 class="cyber-title" id="form-title">LOGIN</h2>

    <div id="login-section" class="form-wrapper active">
        <div class="input-box">
            <input type="email" id="logEmail" placeholder="Enter Email">
        </div>
        <div class="input-box">
            <input type="password" id="logPass" placeholder="Enter Password">
        </div>
        <button class="cyber-btn" id="loginBtn">LOG IN</button>
        <p class="switch-text">Don't have an account? <span id="toSignup">Create Account</span></p>
    </div>

    <div id="signup-section" class="form-wrapper">
        <div class="input-box">
            <input type="text" id="sigName" placeholder="Full Name">
        </div>
        <div class="input-box">
            <input type="email" id="sigEmail" placeholder="Email Address">
        </div>
        <div class="input-box">
            <input type="password" id="sigPass" placeholder="Set Password">
        </div>
        <button class="cyber-btn" id="signupBtn">REGISTER</button>
        <p class="switch-text">Already a member? <span id="toLogin">Login Now</span></p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD5yA9_Ieu05rC4qYVuokI04MZ5ggLpAms",
        authDomain: "profibharat-system.firebaseapp.com",
        projectId: "profibharat-system",
        storageBucket: "profibharat-system.firebasestorage.app",
        messagingSenderId: "737868719964",
        appId: "1:737868719964:web:57ee8792200f6f4c418399"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Tab Logic
    const loginSec = document.getElementById('login-section');
    const signupSec = document.getElementById('signup-section');
    const title = document.getElementById('form-title');

    document.getElementById('toSignup').onclick = () => {
        loginSec.classList.remove('active'); signupSec.classList.add('active');
        title.innerText = "SIGNUP";
    };
    document.getElementById('toLogin').onclick = () => {
        signupSec.classList.remove('active'); loginSec.classList.add('active');
        title.innerText = "LOGIN";
    };

    // --- SIGNUP BACKEND ---
    document.getElementById('signupBtn').addEventListener('click', async () => {
        const email = document.getElementById('sigEmail').value.trim().toLowerCase();
        const pass = document.getElementById('sigPass').value;
        const name = document.getElementById('sigName').value;

        if(!email || !pass) {
            Swal.fire('Error!', 'Please fill all details', 'warning');
            return;
        }

        try {
            const q = query(collection(db, "users"), where("email", "==", email));
            const snap = await getDocs(q);
            if(!snap.empty) {
                Swal.fire('Already Exists!', 'Email is already registered.', 'error');
                return;
            }

            await addDoc(collection(db, "users"), { name, email, pass });
            Swal.fire('Success!', 'Account Created Successfully!', 'success').then(() => {
                document.getElementById('toLogin').click();
            });
        } catch(e) { Swal.fire('Error!', e.message, 'error'); }
    });

    // --- LOGIN BACKEND (With Smart Popups) ---
    document.getElementById('loginBtn').addEventListener('click', async () => {
        const email = document.getElementById('logEmail').value.trim().toLowerCase();
        const pass = document.getElementById('logPass').value;

        if(!email || !pass) {
            Swal.fire('Empty!', 'Please enter email and password.', 'info');
            return;
        }

        try {
            const q = query(collection(db, "users"), where("email", "==", email));
            const snap = await getDocs(q);

            if(snap.empty) {
                // ACCOUNT NAHI HAI POPUP
                Swal.fire({
                    title: 'No Account Found!',
                    text: "You don't have an account. Please register first.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Register Now'
                }).then((result) => {
                    if (result.isConfirmed) document.getElementById('toSignup').click();
                });
                return;
            }

            let userFound = false;
            snap.forEach((doc) => {
                if(doc.data().pass === pass) userFound = true;
            });

            if(userFound) {
                // SUCCESS POPUP
                Swal.fire({
                    title: 'Welcome Back!',
                    text: 'Login Successful!',
                    icon: 'success',
                    timer: 2000,
                    showConfirmButton: false
                }).then(() => {
                    localStorage.setItem("loggedIn", "true");
                    window.location.href = "home.html";

                });
            } else {
                // WRONG PASSWORD POPUP
                Swal.fire('Wrong Password!', 'Please enter the correct password.', 'error');
            }
        } catch(e) { Swal.fire('Error!', 'Database connection failed.', 'error'); }
    });
</script>
</body>
</html>
