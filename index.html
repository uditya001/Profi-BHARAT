<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProfiBHARAT | Secure Mobile Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@600;900&family=Outfit:wght@300;600&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: #030005; height: 100dvh; display: flex; align-items: center; justify-content: center; font-family: 'Outfit', sans-serif; color: #fff; overflow: hidden; }

        .hologram-grid { position: absolute; width: 200%; height: 200%; background-image: linear-gradient(rgba(168, 85, 247, 0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(168, 85, 247, 0.08) 1px, transparent 1px); background-size: 50px 50px; transform: perspective(500px) rotateX(60deg); z-index: 1; animation: gridMove 10s linear infinite; }
        @keyframes gridMove { from { transform: translateY(0); } to { transform: translateY(50px); } }

        /* Mobile Optimized Card */
        .auth-card { position: relative; z-index: 10; background: rgba(8, 4, 10, 0.9); padding: 30px 25px; border-radius: 24px; border: 1px solid rgba(168, 85, 247, 0.3); width: 92%; max-width: 370px; backdrop-filter: blur(15px); text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        
        .cyber-title { font-family: 'Unbounded'; font-size: 1.25rem; margin-bottom: 25px; color: #a855f7; text-shadow: 0 0 10px #a855f7; }

        .form-wrapper { display: none; }
        .form-wrapper.active { display: block; animation: zoomIn 0.3s ease; }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .input-box { margin-bottom: 15px; }
        .input-box input { width: 100%; padding: 15px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; }
        .input-box input:focus { border-color: #a855f7; background: rgba(168, 85, 247, 0.05); }

        .cyber-btn { width: 100%; padding: 16px; border-radius: 14px; border: none; background: linear-gradient(90deg, #a855f7, #6b21a8); color: #fff; font-family: 'Unbounded'; font-size: 0.85rem; cursor: pointer; font-weight: 900; transition: 0.2s; }
        .cyber-btn:active { transform: scale(0.96); opacity: 0.9; }

        .switch-text { margin-top: 20px; font-size: 0.85rem; color: #888; }
        .switch-text span { color: #a855f7; cursor: pointer; font-weight: bold; }

        /* Custom Mobile SweetAlert Styling */
        .mobile-swal { border-radius: 20px !important; width: 85% !important; max-width: 300px !important; padding-bottom: 20px !important; }
    </style>
</head>
<body>

<div class="hologram-grid"></div>

<div class="auth-card animate__animated" id="main-card">
    <h2 class="cyber-title" id="form-title">LOGIN ACCOUNT</h2>

    <div id="login-section" class="form-wrapper active">
        <div class="input-box"><input type="email" id="logEmail" placeholder="Email Address"></div>
        <div class="input-box"><input type="password" id="logPass" placeholder="Password"></div>
        <button class="cyber-btn" id="loginBtn">LOGIN</button>
        <p class="switch-text">New user? <span id="toSignup">Create Account</span></p>
    </div>

    <div id="signup-section" class="form-wrapper">
        <div class="input-box"><input type="text" id="sigName" placeholder="Full Name"></div>
        <div class="input-box"><input type="email" id="sigEmail" placeholder="Email Address"></div>
        <div class="input-box"><input type="password" id="sigPass" placeholder="Set Password"></div>
        <button class="cyber-btn" id="signupBtn">REGISTER</button>
        <p class="switch-text">Have account? <span id="toLogin">Login Now</span></p>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD5yA9_Ieu05rC4qYVuokI04MZ5ggLpAms",
        authDomain: "profibharat-system.firebaseapp.com",
        projectId: "profibharat-system",
        storageBucket: "profibharat-system.firebasestorage.app",
        messagingSenderId: "737868719964",
        appId: "1:737868719964:web:57ee8792200f6f4c418399"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- Mobile Friendly Popup Helper ---
    const showPop = (title, text, icon, anim = 'fadeInUp') => {
        Swal.fire({
            title: title,
            text: text,
            icon: icon,
            background: '#0f0a14',
            color: '#fff',
            confirmButtonColor: '#a855f7',
            customClass: { popup: 'mobile-swal' },
            showClass: { popup: `animate__animated animate__${anim}` },
            hideClass: { popup: 'animate__animated animate__fadeOutDown' },
            timer: 2000,
            showConfirmButton: false
        });
    };

    const card = document.getElementById('main-card');
    const loginSec = document.getElementById('login-section');
    const signupSec = document.getElementById('signup-section');

    document.getElementById('toSignup').onclick = () => {
        loginSec.classList.remove('active'); signupSec.classList.add('active');
        document.getElementById('form-title').innerText = "SIGNUP";
    };
    document.getElementById('toLogin').onclick = () => {
        signupSec.classList.remove('active'); loginSec.classList.add('active');
        document.getElementById('form-title').innerText = "LOGIN";
    };

    // --- LOGIN BACKEND ---
    document.getElementById('loginBtn').onclick = async () => {
        const email = document.getElementById('logEmail').value.trim().toLowerCase();
        const pass = document.getElementById('logPass').value;

        if(!email || !pass) return showPop('Oops!', 'Enter details', 'info');

        try {
            const q = query(collection(db, "users"), where("email", "==", email));
            const snap = await getDocs(q);

            if(snap.empty) {
                card.classList.add('animate__headShake');
                setTimeout(() => card.classList.remove('animate__headShake'), 500);
                showPop('No Account', 'Register first!', 'warning');
                return;
            }

            let ok = false;
            snap.forEach(doc => { if(doc.data().pass === pass) ok = true; });

            if(ok) {
                showPop('Success', 'Welcome Back!', 'success');
                setTimeout(() => window.location.href = "home.html", 1500);
            } else {
                card.classList.add('animate__shakeX');
                setTimeout(() => card.classList.remove('animate__shakeX'), 500);
                showPop('Error', 'Wrong Password!', 'error');
            }
        } catch(e) { showPop('Error', 'Network Error', 'error'); }
    };

    // --- SIGNUP BACKEND ---
    document.getElementById('signupBtn').onclick = async () => {
        const email = document.getElementById('sigEmail').value.trim().toLowerCase();
        const pass = document.getElementById('sigPass').value;
        const name = document.getElementById('sigName').value;

        try {
            const q = query(collection(db, "users"), where("email", "==", email));
            const snap = await getDocs(q);
            if(!snap.empty) return showPop('Exists', 'Already registered!', 'error');

            await addDoc(collection(db, "users"), { name, email, pass });
            showPop('Done!', 'Account Created!', 'success');
            setTimeout(() => document.getElementById('toLogin').click(), 1500);
        } catch(e) { showPop('Error', 'Failed!', 'error'); }
    };
</script>

</body>
</html>
