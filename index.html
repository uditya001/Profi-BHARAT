<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ProfiBHARAT | Secure Access</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@600;900&family=Outfit:wght@300;600&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { background: #030005; height: 100dvh; display: flex; align-items: center; justify-content: center; font-family: 'Outfit', sans-serif; color: #fff; overflow: hidden; }
        .hologram-grid { position: absolute; width: 200%; height: 200%; background-image: linear-gradient(rgba(168, 85, 247, 0.08) 1px, transparent 1px), linear-gradient(90deg, rgba(168, 85, 247, 0.08) 1px, transparent 1px); background-size: 50px 50px; transform: perspective(500px) rotateX(60deg); z-index: 1; animation: gridMove 10s linear infinite; }
        @keyframes gridMove { from { transform: translateY(0); } to { transform: translateY(50px); } }
        .auth-card { position: relative; z-index: 10; background: rgba(8, 4, 10, 0.9); padding: 30px 25px; border-radius: 24px; border: 1px solid rgba(168, 85, 247, 0.3); width: 92%; max-width: 370px; backdrop-filter: blur(15px); text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .cyber-title { font-family: 'Unbounded'; font-size: 1.25rem; margin-bottom: 25px; color: #a855f7; text-shadow: 0 0 10px #a855f7; }
        .form-wrapper { display: none; }
        .form-wrapper.active { display: block; animation: zoomIn 0.3s ease; }
        .input-box { margin-bottom: 12px; text-align: left; }
        .input-box input, .input-box select { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; font-size: 0.95rem; }
        .input-box select option { background: #08040a; color: #fff; }
        .hint-text { font-size: 10px; color: #a855f7; margin-top: 4px; margin-left: 5px; opacity: 0.8; }
        .cyber-btn { width: 100%; padding: 16px; border-radius: 14px; border: none; background: linear-gradient(90deg, #a855f7, #6b21a8); color: #fff; font-family: 'Unbounded'; font-size: 0.85rem; cursor: pointer; font-weight: 900; margin-top: 10px; }
        .switch-text { margin-top: 15px; font-size: 0.85rem; color: #888; }
        .switch-text span { color: #a855f7; cursor: pointer; font-weight: bold; padding: 5px; }
    </style>
</head>
<body>
<div class="hologram-grid"></div>
<div class="auth-card animate__animated" id="main-card">
    <h2 class="cyber-title" id="form-title">LOGIN</h2>
    <div id="login-section" class="form-wrapper active">
        <div class="input-box"><input type="email" id="logEmail" placeholder="Email Address"></div>
        <div class="input-box"><input type="password" id="logPass" placeholder="Password"></div>
        <button class="cyber-btn" id="loginBtn">LOGIN</button>
        <p class="switch-text">New here? <span onclick="switchForm('signup')">Create Account</span></p>
    </div>
    <div id="signup-section" class="form-wrapper">
        <div class="input-box"><input type="text" id="sigName" placeholder="Full Name"></div>
        <div class="input-box"><input type="email" id="sigEmail" placeholder="Email Address"><p class="hint-text">Original email only</p></div>
        <div class="input-box"><input type="number" id="sigMobile" placeholder="Mobile Number"></div>
        <div class="input-box"><select id="sigGender"><option value="" disabled selected>Select Gender</option><option value="Male">Male</option><option value="Female">Female</option></select></div>
        <div class="input-box"><select id="sigQual"><option value="" disabled selected>Qualification</option><option value="10th">10th Pass</option><option value="12th">12th Pass</option><option value="Undergraduate">Undergraduate (UG)</option><option value="Postgraduate">Postgraduate (PG)</option><option value="Other">Other</option></select></div>
        <div class="input-box"><input type="password" id="sigPass" placeholder="Set Password"><p class="hint-text">Min 6 chars + 1 special symbol</p></div>
        <button class="cyber-btn" id="signupBtn">REGISTER</button>
        <p class="switch-text">Have account? <span onclick="switchForm('login')">Login Now</span></p>
    </div>
</div>

<script>
    function switchForm(t) {
        document.getElementById('login-section').classList.toggle('active', t==='login');
        document.getElementById('signup-section').classList.toggle('active', t==='signup');
        document.getElementById('form-title').innerText = t.toUpperCase();
    }
</script>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD5yA9_Ieu05rC4qYVuokI04MZ5ggLpAms",
        authDomain: "profibharat-system.firebaseapp.com",
        projectId: "profibharat-system",
        storageBucket: "profibharat-system.firebasestorage.app",
        messagingSenderId: "737868719964",
        appId: "1:737868719964:web:57ee8792200f6f4c418399"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const showPop = (t, m, i) => Swal.fire({title:t, text:m, icon:i, background:'#0f0a14', color:'#fff', confirmButtonColor:'#a855f7', timer:2000, showConfirmButton:false});
    const validEmail = (e) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
    const validPass = (p) => p.length >= 6 && /[!@#$%^&*(),.?":{}|<>]/.test(p);

    // LOGIN LOGIC
    document.getElementById('loginBtn').onclick = async () => {
        const email = document.getElementById('logEmail').value.trim().toLowerCase();
        const pass = document.getElementById('logPass').value;
        if(!validEmail(email)) return showPop('Error', 'Invalid Email Format', 'error');

        const q = query(collection(db, "users"), where("email", "==", email));
        const snap = await getDocs(q);
        let user = null;
        snap.forEach(doc => { if(doc.data().pass === pass) user = doc.data(); });

        if(user) {
            localStorage.setItem('profiUser', JSON.stringify(user));
            showPop('Welcome!', 'Login Successful', 'success');
            setTimeout(() => window.location.href = "home.html", 1500);
        } else { showPop('Error', 'Wrong Email or Password', 'error'); }
    };

    // SIGNUP LOGIC
    document.getElementById('signupBtn').onclick = async () => {
        const d = {
            name: document.getElementById('sigName').value.trim(),
            email: document.getElementById('sigEmail').value.trim().toLowerCase(),
            mobile: document.getElementById('sigMobile').value.trim(),
            gender: document.getElementById('sigGender').value,
            qualification: document.getElementById('sigQual').value,
            pass: document.getElementById('sigPass').value
        };

        if(!d.name || !d.email || !d.mobile || !d.gender || !d.qualification || !d.pass) return showPop('Wait', 'Fill all fields', 'warning');
        if(!validEmail(d.email)) return showPop('Error', 'Use real email address', 'error');
        if(!validPass(d.pass)) return showPop('Weak', 'Min 6 chars + 1 special symbol (@, #, $)', 'error');

        const q = query(collection(db, "users"), where("email", "==", d.email));
        const snap = await getDocs(q);
        if(!snap.empty) return showPop('Error', 'Email already used', 'warning');

        await addDoc(collection(db, "users"), d);
        showPop('Success!', 'Registered! Please Login now.', 'success');
        setTimeout(() => { switchForm('login'); document.getElementById('logEmail').value = d.email; }, 2000);
    };
</script>
</body>
</html>
